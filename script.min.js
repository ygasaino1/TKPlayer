let player=null;let a=document.querySelector("#video-iframe");let A=a.cloneNode();let p=document.querySelector("#vid-container");let V=document.querySelector("#twitch-container");let h=null;let D=document.querySelector("#back-container");let t=document.querySelector("#back-iframe");let i=document.querySelector("audio");let d;let y=null;let w="";let l=document.querySelector("#console-input");let o=document.querySelector("#console");let n=document.querySelector("#console-flex");let k="#ffd3dc";let r="#00b1ff";let e;let z=1e3;let s=100;let q=.8;let c=false;function g(e,t=k){let i=b(`<div class="console" style="color: ${t}">${e}</div>`);l.appendChild(i);while(o.scrollHeight>o.clientHeight&&l.childNodes.length>2){l.childNodes[1].remove()}}function u(){o.style.zIndex=s;if(!c){clearTimeout(e);e=setTimeout(()=>{o.style.zIndex="0"},z)}}function b(e){var t=document.createElement("template");e=e.trim();t.innerHTML=e;return t.content.firstChild}String.prototype.replaceAt=function(e,t){return this.substring(0,e)+t+this.substring(e+1)};function Y(){let t=/\/video\/(\w+)|bvid=(\w+)/i;let i=decodeURI(y.href);let e="";let l="";if(t.test(i)){let e=i.match(t);l=e[1]||e[2]||""}let o=parseInt(y.searchParams.get("t"))||parseInt(y.searchParams.get("time"))||0;if("t"in C.param){o+=parseInt(C.param["t"])||0}e=`https://player.bilibili.com/player.html?&bvid=${l}&page=1&autoplay=1&t=${o}`;F(e)}function F(e){a.setAttribute("src",e)}function M(){let t=/\/([\w-]+)\/([\w-]+)\/?$/i;let i=decodeURI(y.href);let e="";let l="";let o="";if(t.test(i)){let e=i.match(t);if(e.length>=3){if(e[1].toLowerCase()=="live"){l=e[2]||""}else{l=e[1]||"";o=e[2]||""}}else{U()}}let n=parseInt(y.searchParams.get("t"))||parseInt(y.searchParams.get("time"))||0;if("t"in C.param){n+=parseInt(C.param["t"])||0}if(l&&o){e=`https://www.mixcloud.com/widget/iframe/?feed=/${l}/${o}/`;a.setAttribute("src",e);if(!f){f=W()}f.then(()=>{player=Mixcloud.PlayerWidget(document.getElementById("video-iframe"));player.ready.then(function(){player.events.ended.on(()=>{if(T.length>0||!("loop"in C.param)){N()}else{player.seek(0);player.play()}});Q(n)})})}else{U()}}function Q(e){player.play();player.setOption("hide_cover",true);if(e!=0){player.seek(e)}}let f=null;function W(){return new Promise((e,t)=>{let i=document.createElement("script");i.id="mixcloud-script";i.src="https://widget.mixcloud.com/media/js/widgetApi.js";i.async=true;i.onload=()=>{e()};let l=document.getElementsByTagName("script")[0];l.parentNode.insertBefore(i,l);g("___ Mixcloud Initialization...")})}function B(){let e=decodeURI(y.href);let t=`https://w.soundcloud.com/player/?url=${e}&color=%23ff5500&auto_play=true&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=true`;H(t)}function H(e){a.setAttribute("src",e)}function J(){player=null;let t=/^.*www\.twitch\.tv\/([^\?\/]+)$|.*\/\?channel=([^&]*)/i;let i=/.*\/\?video=(\w+)|.*\/videos\/([^?]*)/i;let l=/.*collection=(\w+)/i;let o=decodeURI(y.href);let e="";let n="";let a="";let r="";if(t.test(o)){let e=o.match(t);n=e[1]||e[2]||""}if(i.test(o)){let e=o.match(i);a=e[1]||e[2]||""}if(l.test(o)){let e=o.match(l);r=e[1]||""}e=`https://player.twitch.tv/?parent=${d.hostname}&autoplay=true`;if(n!=""){e+=`&channel=${n}`}if(a!=""){e+=`&video=${a}`}if(r!=""){e+=`&collection=${r}`}let s=0;let c=y.searchParams.get("t")||y.searchParams.get("time")||"";if(/^.*\D.*$/.test(c)){let e=c.match(/(\d*h)?(\d*m)?(\d*s)/i);s+=parseInt(e[1])*3600||0;s+=parseInt(e[2])*60||0;s+=parseInt(e[3])||0}else{s=parseInt(c)||0}if("t"in C.param){s+=parseInt(C.param["t"])||0}e+=`&time=${s}`;let u={autoplay:true,width:"100%",height:"100%"};if(n!=""){u.channel=n}else if(a!=""){u.video=a}else if(r!=""){u.collection=r}if(s!=0){u.time=`${s}`}player=new Twitch.Player("twitch-container",u);player.addEventListener(Twitch.Player.VIDEO_PLAY,m);player.addEventListener(Twitch.Player.ENDED,G)}function m(){player.removeEventListener(Twitch.Player.VIDEO_PLAY,m);if(!("max"in C.param)){return}let e="twitch: Setting quality...";g(e);let t="Auto";e=`${player.getQualities().length} Qualities Present`;g(e);if(player.getQualities().length>1){e=`${player.getQualities()[1].group}`;g("quality: "+e);player.setQuality(e)}}function G(){N()}function K(){let e="";video_reg=/\/(\w+)[^\/]*$/i;let t=decodeURI(y.href);let i="";if(video_reg.test(t)){let e=t.match(video_reg);i=e[1]||e[2]||""}if("loop"in C.param){e=`https://player.vimeo.com/video/${i}?autoplay=1&loop=1&autopause=0`}else{e=`https://player.vimeo.com/video/${i}?autoplay=1`}X(e)}function X(e){a.setAttribute("src",e)}function Z(){let e=decodeURI(y.href);let t="";ee(t)}function ee(e){a.setAttribute("src",e)}let te=`AIzaSyASq2_wSS45nCkxTy71WW5CKAhPzRn6pHU`;let v=null;let ie=["playVideo()","pauseVideo()","stopVideo()","clearVideo()","nextVideo()","previousVideo()","mute()","unMute()","setVolume(vol)","seekTo(time)","setPlaybackRate(rate)","showVideoInfo()","hideVideoInfo()"];function le(e){e=e.split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/|\/shorts\/)/);return e[2]!==undefined?e[2].split(/[^0-9a-z_\-]/i)[0]:e[0]}let E=-1;function oe(){let l=decodeURI(y.href);let o="";let e="";let n="";if("list"in C.param||y.pathname.toLowerCase().includes("videoseries")||y.pathname.toLowerCase().includes("playlist")){if(!l.includes("list=LL")&&!l.toLowerCase().includes("start_radio=1")){if(y.searchParams.has("playlist")){e=y.searchParams.get("playlist")}if(y.searchParams.has("list")){e=y.searchParams.get("list")}if("loop"in C.param){o=`https://www.youtube.com/embed/videoseries?list=${e}&enablejsapi=1&controls=0&loop=1&`}else{o=`https://www.youtube.com/embed/videoseries?list=${e}&enablejsapi=1&controls=0&`}}}else if(e==""){n=le(l);let e=parseInt(y.searchParams.get("t"))||parseInt(y.searchParams.get("time"))||0;if("t"in C.param){e+=parseInt(C.param["t"])||0}E=-1;let t=e;let i=-1;if("crop"in C.param){let e=C.param["crop"].split("-");try{E=Number(e[0]);t+=Number(e[0])}catch(e){g(e)}try{if(e.length>1){i=Number(e[1])}}catch(e){g(e)}}o=`https://www.youtube.com/embed/${n}?enablejsapi=1&controls=0&start=${t}`;if(i!=-1){o+=`&end=${i}`}}if("mute"in C.param){o+="&mute=1"}v=C.param;ne(o)}function ne(e){a.setAttribute("src",e);if(!I){R()}}let I=false;function R(){let e=document.createElement("script");e.id="iframe-demo";e.src="https://www.youtube.com/iframe_api";let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t);I=true}function onYouTubeIframeAPIReady(){let e={events:{onReady:ae,onStateChange:re}};player=new YT.Player("video-iframe",e)}function ae(e){player.playVideo();se();ce()}if(a.getAttribute("src")!="no-source"){R()}let L=[0,0,0];function re(e){L.unshift(e.data);L.pop();if(L[0]==YT.PlayerState.PLAYING&&L[1]==YT.PlayerState.BUFFERING&&L[2]==YT.PlayerState.UNSTARTED){t()}if(e.data==YT.PlayerState.ENDED&&T.length>0){N()}else if(e.data==YT.PlayerState.ENDED&&"loop"in v&&!("list"in v)){player.playVideo();if(E!=-1){player.seekTo(E)}}else if(e.data==YT.PlayerState.ENDED){N()}function t(){let e=player.videoTitle;document.title=e;g(`___ [${e}]`);g(`___ [${player.getDuration()}]`)}}function se(){let i=null;Object.keys(C.param).forEach(e=>{let t=e.match(/^(\d+\.?\d*)x$/i);if(t&&t.length>1){i=Number(t[1])}});if(i){player.setPlaybackRate(i)}}function ce(){let i=null;let e=false;Object.keys(C.param).forEach(e=>{let t=e.match(/^(\d+\.?\d*)v$/i);if(t&&t.length>1){i=Number(t[1])}});if(i){if(i<0){i=0}if(i>100){i=100}player.setVolume(i)}}function ue(){let t=decodeURI(y.href);let e="";let i="";radio_reg=/\/(\w+)\/?$/i;if(radio_reg.test(t)){let e=t.match(radio_reg);i=e[1]||""}e=`https://zeno.fm/player/${i}`;de(e)}function de(e){a.setAttribute("src",e)}function fe(n){let a=7e3;let e=1;if(n.toLowerCase().startsWith("waa",5)){e=3;n=n.replace(n.substring(5,9),"")}for(let o=0;o<e;o++){let e=$(`<p id="back">${n}</p>`);let t=$(`<p id="front">${n}</p>`);let i=Math.random()*(window.innerHeight-200);let l=0;if(o>0){l=Math.random()*1e3}e.css("position","absolute");e.css("left",window.innerWidth+l);e.css("top",i);e.css("white-space","pre");t.css("position","absolute");t.css("left",window.innerWidth+l);t.css("top",i);t.css("white-space","pre");e.appendTo("body");t.appendTo("body");e.animate({left:e.width()*-1},a,"linear",function(){e.remove()});t.animate({left:t.width()*-1},a,"linear",function(){t.remove()})}}function U(){let e=decodeURI(y.href);me(e)}function me(e){window.location.href=e}function pe(){let e=decodeURI(y.href);he(e)}function he(e){w="Radio Loading...";g(w);i.setAttribute("src",e);i.play()}player=null;function ye(){let o=decodeURI(y.href);let n=C.param;let a=0;w="Video Loading...";g(w);const t={m3u8:"application/x-mpegURL",mpd:"application/dash+xml",mp4:"video/mp4",m4v:"video/mp4",webm:"video/webm",mp3:"audio/mpeg",m4a:"audio/mp4",ogg:"audio/ogg",wav:"audio/wav",flac:"audio/flac",aac:"audio/aac"};const e="https://unpkg.com/@videojs/http-streaming@3.15.0/dist/videojs-http-streaming.min.js";const i={m3u8:e,mpd:e};const l=["m3u8","mpd"];let r=o;let s="";let c=false;Object.keys(t).forEach(e=>{if(!c&&r.toLowerCase().includes(e)){s=e;c=true}});let u=false;Object.keys(t).forEach(e=>{if(!u&&e in n){s=e;u=true}});if(!(s in t)){throw new Error(`Unsupported media extension: ${s}. Supported extensions are: ${Object.keys(t).join(", ")}`)}if(window.videojs){m(r,t[s]);return}const d=document.createElement("link");d.rel="stylesheet";d.href="https://vjs.zencdn.net/8.23.3/video-js.min.css";document.head.appendChild(d);const f=document.createElement("script");f.src="https://vjs.zencdn.net/8.23.3/video.min.js";f.onload=()=>{if(s in i){const e=document.createElement("script");e.src=i[s];e.onload=()=>m(r,t[s]);e.onerror=()=>{console.error("Failed to load videojs plugin");throw new Error("Failed to load videojs plugin")};document.body.appendChild(e)}else{m(r,t[s])}};f.onerror=()=>{console.error("Failed to load Video.js");throw new Error("Failed to load Video.js")};document.body.appendChild(f);function m(e,i){let t=`<video id="my-video" class="video-js" style="position: absolute; top:0; left:0; height:100%; width:100%" autoplay preload="auto"></video>`;h=b(t);const l=document.createElement("source");l.src=e;l.type=i;h.appendChild(l);p.appendChild(h);player=videojs(document.querySelector("#my-video"));player.ready(function(){g(`___ [${i}]`);let e=new URL(o);let t=parseInt(e.searchParams.get("t"))||parseInt(e.searchParams.get("time"))||0;a=t;if("t"in n){t+=parseInt(n["t"])||0}this.currentTime(t)});player.on("ended",function(){if(T.length<1&&"loop"in n){player.currentTime(a);player.play()}else{videojs.log("Awww...over so soon?!");h.remove();h=null;N()}})}}let we="https://tiki7.github.io/TKPage3/";let ge=window.location.href;let be="";let O=0;d=new URL(location);let S={};let x={youtube:/(.*youtube\..*)|(.*youtu\.be.*)/i,twitch:/.*\.twitch\..*/i,vimeo:/.*vimeo\.\w+\//i,soundcloud:/\w*.?soundcloud\.\w+/i,bilibili:/\.bilibili\./i,zeno:/zeno/i,mixcloud:/\.mixcloud\./i,video:/\.mp4|\.m4v|\.m3u8|\.webm|\.ogv|\.mp3/i};let P={radio:pe};function ve(){let e=C.body;w=`...REQUEST`;if(C.id!=""){w+=`@${C.id}`}g(w);try{y=null;if(e=="off"){e=ge;y=new URL(e);g(`URL off`)}else if(e=="homepage"){e=we;y=new URL(e);g(`URL homepage`)}else{y=new URL(e);if(y.host==location.host||"-"in C.param){w=`URL [*][*][*][*][*] -{___}`}else{w=`URL [${y.protocol}//][${y.host}][${y.pathname}][${y.search}][${y.hash}] -${JSON.stringify(C.param)}`}g(w)}Ee();u()}catch(e){if(y==null){g(`URL ${C.body} -${JSON.stringify(C.param)}`,r)}g(e,r);g("...URL Failed",r);u()}}function Ee(){if(["radio"].some(e=>e in C.param)){_("NOVIDEO");$e("NOVIDEO");Ie("NOVIDEO");Le()}else{_("VIDEO");$e("VIDEO");Ie("VIDEO");Re()}}function _(e){if(O>0&&!("noreload"in C.param)){window.location.reload()}if(e=="VIDEO"){O+=1}}function $e(e){if(e=="VIDEO"){{if(h!=null){h.remove();h=null}a.setAttribute("src","")}if(!("mute"in C.param)){i.setAttribute("src","")}}else if(e=="NOVIDEO"){i.setAttribute("src","")}}function Ie(e){if("debug"in C.param){o.style.zIndex=s}else{o.style.zIndex=0}if(e=="VIDEO"){n.style.backgroundColor=`rgb(0,0,0,${q})`;t.setAttribute("src","")}else if(e=="NOVIDEO"){n.style.backgroundColor=`rgb(0,0,0,0.0)`;t.setAttribute("src","flow\\index.html")}}function Re(){let e=Object.keys(S).filter(e=>e in C.param)[0];if(e!=undefined){S[e]()}else if(x["youtube"].test(y.host)){oe()}else if(x["twitch"].test(y.host)){J()}else if(x["vimeo"].test(y.host)){K()}else if(x["soundcloud"].test(y.host)){B()}else if(x["bilibili"].test(y.host)){Y()}else if(x["zeno"].test(decodeURI(y.host))){ue()}else if(x["mixcloud"].test(decodeURI(y.host))){M()}else if(x["video"].test(decodeURI(y.href))){ye()}else{U()}}function Le(){let e=Object.keys(P).filter(e=>e in C.param)[0];if(e!=undefined){P[e]()}}function Ue(){if(o.style.zIndex=="0"){c=true;o.style.zIndex=s}else{c=false;o.style.zIndex="0"}}window.addEventListener("hashchange",()=>{j(false)});let C={func:"default",body:"",param:{},id:"",extra:{}};function Oe(){let e=false;let t;let i;return e}function Se(e){try{new URL(e);return true}catch(e){return false}}async function xe(e){let t=e.body??"";let i=e.id??"";if(t==null||undefined||""){t=""}else{t=decodeURI(t)}const l=e=>{const t=e.replace(/\./g,"\\.").replace(/\*/g,".*").replace(/\/?$/,"/?").toLowerCase();return new RegExp(`^${t}$`)};let o=false;let n=false;let a=e.env.gate;if(a&&Se(a)){try{const r=await fetch(a);const s=await r.text();const c=s.split("\n");const u={url:[],user:[]};const d={url:[/^homepage$/],user:[]};c.forEach(e=>{if(!e.startsWith("#")){const[t,i]=e.split(":");if(t.trim()==="-USER"){u.user.push(new RegExp(`^${i.trim().toLowerCase()}$`))}else if(t.trim()==="-URL"){u.url.push(l(i.trim()))}else if(t.trim()==="+USER"){d.user.push(new RegExp(`^${i.trim().toLowerCase()}$`))}else if(t.trim()==="+URL"){d.url.push(l(i.trim()))}}});o=u.user.some(e=>{return e.test(i.toLowerCase())})||u.url.some(e=>{return e.test(t)});if(d.user.length>0){n=!d.user.some(e=>{return e.test(i.toLowerCase())})}if(d.url.length>0){n=n||!d.url.some(e=>{return e.test(t)})}}catch(e){console.error("Error fetching or parsing data:",e)}}if(o){}else{}if(n){}else{}return o||n}async function j(e){if(e==false&&await Pe()==false){history.pushState(null,null," ");return}if(C.func=="comment"){fe(C.body)}else if(C.func=="debug"){Ue()}else if(C.func=="default"){if("que"in C.param){_e()}else if("cmd"in C.param){Ce()}else if("help"in C.param){Te()}else{ve()}}history.pushState(null,null," ")}async function Pe(){let o=decodeURI(location.hash).substring(1);try{let t={};try{t=JSON.parse(o)}catch{}let i={overparam:{},func:"default",body:"",param:{},id:"",extra:{},env:{}};let l=["gate"];Object.keys(t).forEach(e=>{if(!l.includes(e.toLowerCase())&&e in i&&t[e]!=null){i[e]=t[e]}});Object.keys(i.overparam).forEach(e=>{if(l.includes(e.toLowerCase())){i.env[e.toLowerCase()]=i.overparam[e]}else{i.param[e]=i.overparam[e]}});delete i.overparam;let e=await xe(i);if(e){history.pushState(null,null," ");return false}else{C=i;return true}}catch(e){return false}}let T=[];function _e(){delete C.param.que;C.param["noreload"]=null;T.push(C);w=`...QUE-REQUEST`;if(C.id!=""){w+=`@${C.id}`}g(w);u()}function N(){if(T.length>0){C=T.shift();j(true)}else if("endmedia"in C.param){let e={func:"default",body:C.param.endmedia,param:{loop:null}};location.hash=JSON.stringify(e)}else{if(h!=null){h.remove();h=null}a.parentElement.replaceChild(A,a)}}function Ce(){w=`...CMD-REQUEST`;if(C.id!=""){w+=`@${C.id}`}g(w);C.body=je(C.body);try{let e=`"use strict";player.${C.body};`;Function(e)();g(`CMD player.${C.body}`);u()}catch(e){g(e,r);g("...CMD Failed",r);u()}}function je(i){i=i.replace(/[;\.\s]/g,"");i=i.substring(0,i.indexOf(")")==-1?i.length:i.indexOf(")")+1);let l=-1;while((l=i.indexOf(",",l+1))!=-1){let e=i.indexOf(")",l);if(e==-1){i=i.replaceAt(l,"");continue}let t=i.indexOf("(",l);if(t!=-1&&t<e){i=i.replaceAt(l,"");continue}if(t==-1&&i.indexOf("(",0)==-1){i=i.replaceAt(l,"");continue}}return i}function Te(){if(C.body.toLowerCase()=="youtube"){g(JSON.stringify(ie,null,1));u()}}a.style.visibility="visible";p.style.visibility="visible";j(false);